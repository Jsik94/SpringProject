<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="onememo.mybatis.mapper.dynamicsql">
 
 	<select id="findOneMemoWithTitleLike" parameterType="Map" resultType="oneMemoDTO">
 		SELECT * FROM onememo
 		WHERE 1=1
 		<if test="title !=null">
 			AND title LIKE '%' || #{title} || '%'
 		</if>
 	</select>
 	
 	<select id="findOneMemoLike" parameterType="Map" resultType="oneMemoDTO">
 		SELECT o.*,name FROM onememo o JOIN members m ON o.id = m.id
 		WHERE 1=1
 		<if test="title !=null">
 			AND title LIKE '%' || #{title} || '%'
 		</if>
 		<if test="name !=null">
 			AND name LIKE '%' || #{name} || '%'
 		</if>
 		<if test="content !=null">
 			AND content LIKE '%' || #{content} || '%'
 		</if>
 	</select>
 	
 	
 	
 	 <select id="findOneMemoLikeChoose" parameterType="Map" resultType="oneMemoDTO">
 		SELECT o.*,name FROM onememo o JOIN members m ON o.id = m.id
 		WHERE 1=1
 		<choose>
 			<when test="title !=null">
 				AND title LIKE '%' || #{title} || '%'
 			</when>
  			<when test="name !=null">
  				AND name LIKE '%' || #{name} || '%'
 			</when>
  			<when test="content !=null">
 				AND content content '%' || #{content} || '%'
 			</when>			
 		</choose>

 	</select>
 	
 	<!-- where 가 AND는 알아서 지워줌  -->
 	 <select id="findOneMemoLikeWhere" parameterType="Map" resultType="oneMemoDTO">
 		SELECT o.*,name FROM onememo o JOIN members m ON o.id = m.id
 		<where>
	 		<if test="title !=null">
	 			AND title LIKE '%' || #{title} || '%'
	 		</if>
	 		<if test="title !=null">
	 			AND name LIKE '%' || #{name} || '%'
	 		</if>
	 		<if test="title !=null">
	 			AND content LIKE '%' || #{content} || '%'
	 		</if>
 		</where>
 	</select>
 	
 	<!-- 
 		trim 기준
 		prefix 접두어 설정 기준앞
 		suffix 접미어 설정 기준뒤
 		
 		prefixOverrides 쿼리가장앞에 해당하는 문자들이 있으면 지워준다
 		suffixOverrides 쿼리가장앞에 해당하는 문자들이 있으면 지워준다
 		
 	 -->
  	 <select id="findOneMemoLikeTrim" parameterType="Map" resultType="oneMemoDTO">
 		SELECT o.*,name FROM onememo o JOIN members m ON o.id = m.id
 		<trim prefix="where" prefixOverrides="AND" suffix="|| '%'">
	 		<if test="title !=null">
	 			AND title LIKE '%' || #{title} 
	 		</if>
	 		<if test="name !=null">
	 			AND name LIKE '%' || #{name}
	 		</if>
	 		<if test="content !=null">
	 			AND content LIKE '%' || #{content}	 		
	 		</if>
 		</trim>
 	</select>
 	
 	 <update id="updateOnememoLikeTrim" parameterType="Map">
 		UPDATE onememo
 		<trim prefix="SET" suffixOverrides=",">
	 		<if test="title !=null">
	 			title= #{title} ,
	 		</if>
	 		<if test="content !=null">
	 			content = #{content},
	 		</if>
 		</trim>
 		WHERE no = #{no}
 	</update>
 	

 	 <update id="updateOnememoSet" parameterType="Map">
 		UPDATE onememo
 		<set>
	 		<if test="title !=null">
	 			title= #{title} ,
	 		</if>
	 		<if test="content !=null">
	 			content = #{content},
	 		</if>
 		</set>
 		WHERE no = #{no}
 	</update> 	
 	
 	
 	
 	<select id="findOneMemoForeach" parameterType="Map" resultType="oneMemoDTO">
 		SELECT * FROM onememo
 		WHERE no IN
 		<foreach collection="keyno" open="("  close=")" item="item" separator=",">
 			#{item}
 		</foreach> 
 	</select> 	
 	
 	<!-- 
 	<select id="findOneMemoForeach" parameterType="List" resultType="oneMemoDTO">
 		SELECT * FROM onememo
 		WHERE no IN
 		<foreach collection="collection" open="("  close=")" item="item" separator=",">
 			#{item}
 		</foreach> 
 	</select> 	
 	 -->
 	 
 	 
 	<delete id="deleteEmail" parameterType="Map" >
 		DELETE onememo
 		WHERE no IN
 		<foreach collection="keyno" open="("  close=")" item="item" separator=",">
 			#{item}
 		</foreach>
 	</delete> 	 	
</mapper>